<!-- ...existing code... -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Horas</title>
    <style>
        /* Márgenes laterales aún más reducidos y ajustes para captura */
        html, body {
            font-size: 18px; /* tamaño base aumentado para mejor legibilidad */
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 85vh;
            padding: 8px; /* un poco más de espacio alrededor */
            background: linear-gradient(to right, #330033, #220427);
            box-sizing: border-box;
        }

        .container {
            width: 100%;
            max-width: 520px; /* algo más ancho para que el texto no quede comprimido */
            padding: 12px;     /* padding interno aumentado para mejor lectura */
            box-sizing: border-box;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            background-color: rgba(211, 211, 211, 0.95);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
            height: auto;
        }

        .bloque {
            margin-bottom: 10px;
        }

        label {
            display: block;
            text-align: center;
            margin-bottom: 8px;
            color: #000;
            font-weight: 700;
            font-size: 1.05rem; /* etiquetas más grandes */
        }

        /* Inputs responsivos: ancho máximo reducido */
        select,
        input[type="text"],
        input[type="time"] {
            width: min(320px, 100%);
            padding: 12px;            /* padding aumentado para facilitar lectura y toque */
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
            text-align: center;
            font-size: 1rem;         /* mayor tamaño de texto en los campos */
            color: #000;
            transition: border-color 0.2s ease;
            display: inline-block;
        }

        h1 {
            color: #000;
            margin-bottom: 8px;
            font-size: 2.6em;   /* título más grande */
            font-weight: 800;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.08);
        }

        .botones {
            margin-top: 14px;
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 16px;   /* botón más grande y cómodo */
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 700;
            color: #fff;
            background: linear-gradient(90deg,#6a82ab,#3b3f7a);
            box-shadow: 0 4px 10px rgba(0,0,0,0.18);
            font-size: 1rem;
        }

        /* Preview overlay */
        #previewOverlay {
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            display: none;
            background: rgba(0,0,0,0.55);
            padding: 12px;
            border-radius: 10px;
            max-width: 95%;
            max-height: 92%;
            box-sizing: border-box;
        }
        #previewBox {
            background: #fff;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 8px 22px rgba(0,0,0,0.25);
            max-height: calc(92vh - 40px);
            overflow: auto;
        }
        #previewBox img {
            display: block;
            max-width: 100%;
            height: auto;
            border-radius: 6px;
        }
        #previewActions {
            margin-top: 10px;
            display:flex;
            gap:10px;
            justify-content:center;
        }
        .tiny-btn {
            padding:8px 12px;
            border-radius:8px;
            border:none;
            cursor:pointer;
            font-weight:700;
            color:#fff;
            background:linear-gradient(90deg,#6a82ab,#3b3f7a);
            font-size:0.95rem;
        }
        .tiny-btn.secondary { background:linear-gradient(90deg,#3b7a3b,#6aa86a); }
    </style>
</head>
<body>
    <div class="container">
        <h1>Horario Feria</h1>

        <div class="bloque">
            <label for="inicioFeria">Inicio de Feria:</label>
            <input type="time" id="inicioFeria" value="08:00">
        </div>

        <div class="bloque">
            <label for="llegadaColegio">Llegada al Colegio:</label>
            <input type="text" id="llegadaColegio" readonly>
        </div>

        <div class="bloque">
            <label for="salirViarTiempo">T. Trayecto</label>
            <select id="salirViarTiempo">
                <option value="5">5 m</option>
                <option value="10">10 m</option>
                <option value="15">15 m</option>
                <option value="20">20 m</option>
                <option value="25">25 m</option>
                <option value="30">30 m</option>
                <option value="35">35 m</option>
                <option value="40">40 m</option>
                <option value="45">45 m</option>
                <option value="50">50 m</option>
                <option value="55">55 m</option>
                <option value="60">1 h</option>
                <option value="65">1 h 5 m</option>
                <option value="70">1 h 10 m</option>
                <option value="75">1 h 15 m</option>
                <option value="80">1 h 20 m</option>
                <option value="85">1 h 25 m</option>
                <option value="90">1 h 30 m</option>
                <option value="95">1 h 35 m</option>
                <option value="100">1 h 40 m</option>
                <option value="105">1 h 45 m</option>
                <option value="110">1 h 50 m</option>
                <option value="115">1 h 55 m</option>
                <option value="120">2 h</option>
                <option value="125">2 h 5 m</option>
                <option value="130">2 h 10 m</option>
                <option value="135">2 h 15 m</option>
                <option value="140">2 h 20 m</option>
                <option value="145">2 h 25 m</option>
                <option value="150">2 h 30 m</option>
                <option value="155">2 h 35 m</option>
                <option value="160">2 h 40 m</option>
                <option value="165">2 h 45 m</option>
                <option value="170">2 h 50 m</option>
                <option value="175">2 h 55 m</option>
                <option value="180">3 h</option>
            </select>
        </div>

        <div class="bloque">
            <label for="salirViarResultado">Salir de Biar:</label>
            <input type="text" id="salirViarResultado" readonly>
        </div>

        <div class="bloque">
            <label for="meDespierto">Me Despierto:</label>
            <input type="text" id="meDespierto" readonly>
        </div>

        <!-- Botones: sólo queda Capturar -->
        <div class="botones">
            <button id="btnCaptura" class="btn" title="Capturar la sección">Capturar pantalla</button>
        </div>
    </div>

    <!-- Preview discreto para la captura (sin pop-ups) -->
    <div id="previewOverlay" aria-hidden="true">
        <div id="previewBox">
            <img id="previewImg" alt="Captura">
            <div id="previewActions">
                <button id="btnGuardar" class="tiny-btn secondary">Guardar</button>
                <button id="btnCerrarPreview" class="tiny-btn">Cerrar</button>
            </div>
        </div>
    </div>

    <script>
        /* cálculo de horas (sin cambios funcionales) */
        function calcularHoras() {
            let inicioFeria = document.getElementById("inicioFeria").value;
            let inicioFeriaHora = parseInt  (inicioFeria.split(":")[0] || "0");
            let inicioFeriaMinuto = parseInt(inicioFeria.split(":")[1] || "0");

            let llegadaColegioHora = inicioFeriaHora - 1;
            let llegadaColegio = (llegadaColegioHora < 10 ? "0" : "") + llegadaColegioHora + ":" + 
                                (inicioFeriaMinuto < 10 ? "0" : "") + inicioFeriaMinuto;
            document.getElementById("llegadaColegio").value = llegadaColegio;

            let salirViarTiempo = parseInt(document.getElementById("salirViarTiempo").value);
            let llegadaColegioHoraSalir = parseInt(llegadaColegio.split(":")[0]);
            let llegadaColegioMinutoSalir = parseInt(llegadaColegio.split(":")[1]);
            let salirViarMinutosTotales = llegadaColegioHoraSalir * 60 + llegadaColegioMinutoSalir - salirViarTiempo;

            let salirViarHora = Math.floor(salirViarMinutosTotales / 60);
            let salirViarMinuto = salirViarMinutosTotales % 60;
            let salirViar = (salirViarHora < 10 ? "0" : "") + salirViarHora + ":" + 
                           (salirViarMinuto < 10 ? "0" : "") + salirViarMinuto;
            document.getElementById("salirViarResultado").value = salirViar;

            let salirViarHoraDespierto = parseInt(salirViar.split(":")[0]);
            let salirViarMinutoDespierto = parseInt(salirViar.split(":")[1]);
            let meDespiertoMinutosTotales = salirViarHoraDespierto * 60 + salirViarMinutoDespierto - 60;

            let meDespiertoHora = Math.floor(meDespiertoMinutosTotales / 60);
            let meDespiertoMinuto = meDespiertoMinutosTotales % 60;

            if (meDespiertoHora < 0) meDespiertoHora += 24;

            let meDespierto = (meDespiertoHora < 10 ? "0" : "") + meDespiertoHora + ":" + 
                             (meDespiertoMinuto < 10 ? "0" : "") + meDespiertoMinuto;
            document.getElementById("meDespierto").value = meDespierto;
        }

        document.getElementById("inicioFeria").addEventListener("change", calcularHoras);
        document.getElementById("salirViarTiempo").addEventListener("change", calcularHoras);
        calcularHoras();
    </script>

    <!-- html2canvas CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        // Captura: reducir márgenes laterales recortando también los lados del canvas
        async function capturarPantalla() {
            const target = document.querySelector('.container');
            const captureBtn = document.getElementById('btnCaptura');
            const previewOverlay = document.getElementById('previewOverlay');
            const previewImg = document.getElementById('previewImg');
            const btnGuardar = document.getElementById('btnGuardar');

            if (!target) return;

            try {
                // aumentar scale para que la captura sea nítida cuando el contenido es más grande
                const canvas = await html2canvas(target, {useCORS: true, scale: 3});
                let finalCanvas = canvas;

                // crop vertical hasta justo arriba del botón (como antes)
                // y crop horizontal para reducir márgenes laterales (izq/der)
                const containerRect = target.getBoundingClientRect();
                const scale = canvas.width / containerRect.width;

                // márgenes CSS que queremos eliminar en la captura (en px CSS)
                const sideMarginCssPx = 6; // ajustar más pequeño para menos espacio lateral
                const marginAboveBtnCss = 6; // espacio por encima del botón

                // pequeño espacio adicional por debajo de la captura (en px CSS)
                const extraBottomCssPx = 8; // recortamos un poco por debajo

                const leftCrop = Math.round(sideMarginCssPx * scale);
                const rightCrop = Math.round(sideMarginCssPx * scale);

                // calcular top del botón relativo al container para recorte vertical
                let sHeight = canvas.height;
                if (captureBtn) {
                    const btnRect = captureBtn.getBoundingClientRect();
                    const btnTopOnCanvas = Math.round((btnRect.top - containerRect.top) * scale);
                    const marginAboveBtnPx = Math.round(marginAboveBtnCss * scale);
                    const extraBottomPx = Math.round(extraBottomCssPx * scale);

                    // Añadimos un poco más por debajo (extraBottomPx), sin pasarnos del canvas
                    sHeight = Math.min(canvas.height, btnTopOnCanvas - marginAboveBtnPx + extraBottomPx);
                }

                // calcular ancho final tras recortar los lados
                const sWidth = canvas.width - leftCrop - rightCrop;

                // Validar dimensiones mínimas
                if (sWidth > 20 && sHeight > 20) {
                    const newCanvas = document.createElement('canvas');
                    newCanvas.width = sWidth;
                    newCanvas.height = sHeight;
                    const ctx = newCanvas.getContext('2d');
                    // dibujar la región recortada: (leftCrop, 0) ancho sWidth, altura sHeight
                    ctx.drawImage(canvas,
                        leftCrop, 0,                // sx, sy
                        sWidth, sHeight,            // sWidth, sHeight
                        0, 0,                       // dx, dy
                        sWidth, sHeight             // dWidth, dHeight
                    );
                    finalCanvas = newCanvas;
                }

                const blob = await new Promise(resolve => finalCanvas.toBlob(resolve, 'image/png'));
                if (!blob) return;

                const url = URL.createObjectURL(blob);
                previewImg.src = url;
                previewOverlay.style.display = 'block';
                previewOverlay.setAttribute('aria-hidden', 'false');

                btnGuardar.onclick = () => {
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'captura.png';
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                };

                // intento silencioso de copiar al portapapeles (si permite)
                if (navigator.clipboard && window.ClipboardItem) {
                    blob.arrayBuffer().then(buffer => {
                        const clipboardItemInput = new ClipboardItem({ 'image/png': new Blob([buffer], {type: 'image/png'}) });
                        navigator.clipboard.write([clipboardItemInput]).catch(()=>{});
                    }).catch(()=>{});
                }

            } catch (err) {
                return;
            }
        }

        document.getElementById('btnCerrarPreview').addEventListener('click', () => {
            const previewOverlay = document.getElementById('previewOverlay');
            const previewImg = document.getElementById('previewImg');
            if (previewImg && previewImg.src) {
                URL.revokeObjectURL(previewImg.src);
                previewImg.src = '';
            }
            previewOverlay.style.display = 'none';
            previewOverlay.setAttribute('aria-hidden', 'true');
        });

        document.getElementById('btnCaptura').addEventListener('click', capturarPantalla);
    </script>
</body>
</html>
<!-- ...existing code... -->